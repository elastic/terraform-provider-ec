---
page_title: "Elastic Cloud: ec_deployment_traffic_filter Resource"
description: |-
  Provides an Elastic Cloud traffic filter resource, which allows traffic filter rules to be created, updated, and deleted. Traffic filter rules are used to limit inbound traffic to deployment resources.

  ~> **Note on traffic filters** If you use traffic_filter on an ec_deployment, Terraform will manage the full set of traffic rules for the deployment, and treat additional traffic filters as drift. For this reason, traffic_filter cannot be mixed with the ec_deployment_traffic_filter_association resource for a given deployment.
---

# Resource: ec_deployment_traffic_filter

Provides an Elastic Cloud traffic filter resource, which allows traffic filter rules to be created, updated, and deleted. Traffic filter rules are used to limit inbound traffic to deployment resources.

  ~> **Note on traffic filters** If you use traffic_filter on an ec_deployment, Terraform will manage the full set of traffic rules for the deployment, and treat additional traffic filters as drift. For this reason, traffic_filter cannot be mixed with the ec_deployment_traffic_filter_association resource for a given deployment.

## Example Usage

### IP based traffic filter

```terraform
data "ec_stack" "latest" {
  version_regex = "latest"
  region        = "us-east-1"
}

# Create an Elastic Cloud deployment
resource "ec_deployment" "example_minimal" {
  # Optional name.
  name = "my_example_deployment"

  # Mandatory fields
  region                 = "us-east-1"
  version                = data.ec_stack.latest.version
  deployment_template_id = "aws-io-optimized-v2"

  traffic_filter = [
    ec_deployment_traffic_filter.example.id
  ]

  # Use the deployment template defaults
  elasticsearch = {
    hot = {
      autoscaling = {}
    }
  }

  kibana = {}
}

resource "ec_deployment_traffic_filter" "example" {
  name   = "my traffic filter name"
  region = "us-east-1"
  type   = "ip"

  rule {
    source = "0.0.0.0/0"
  }
}
```

### Azure Private Link traffic filter

```terraform
locals {
  region = azure-australiaeast
}

data "ec_stack" "latest" {
  version_regex = "latest"
  region        = local.region
}

# Create an Elastic Cloud deployment
resource "ec_deployment" "example_minimal" {
  # Optional name.
  name = "my_example_deployment"

  # Mandatory fields
  region                 = local.region
  version                = data.ec_stack.latest.version
  deployment_template_id = "azure-io-optimized-v3"

  traffic_filter = [
    ec_deployment_traffic_filter.azure.id
  ]

  # Use the deployment template defaults
  elasticsearch = {
    hot = {
      autoscaling = {}
    }
  }

  kibana = {}
}

resource "ec_deployment_traffic_filter" "azure" {
  name   = "my traffic filter name"
  region = local.region
  type   = "azure_private_endpoint"

  rule {
    azure_endpoint_name = "my-azure-pl"
    azure_endpoint_guid = "78c64959-fd88-41cc-81ac-1cfcdb1ac32e"
  }
}
```

###GCP Private Service Connect traffic filter

```terraform
locals {
  region = asia-east1
}

data "ec_stack" "latest" {
  version_regex = "latest"
  region        = local.region
}

# Create an Elastic Cloud deployment
resource "ec_deployment" "example_minimal" {
  # Optional name.
  name = "my_example_deployment"

  # Mandatory fields
  region                 = local.region
  version                = data.ec_stack.latest.version
  deployment_template_id = "gcp-storage-optimized"

  traffic_filter = [
    ec_deployment_traffic_filter.gcp_psc.id
  ]

  # Use the deployment template defaults
  elasticsearch = {
    hot = {
      autoscaling = {}
    }
  }

  kibana = {}
}

resource "ec_deployment_traffic_filter" "gcp_psc" {
  name   = "my traffic filter name"
  region = local.region
  type   = "gcp_private_service_connect_endpoint"

  rule {
    source = "18446744072646845332"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Name of the ruleset
- `region` (String) Filter region, the ruleset can only be attached to deployments in the specific region
- `type` (String) Type of the ruleset. It can be `ip`, `vpce`, `azure_private_endpoint`, or `gcp_private_service_connect_endpoint`

### Optional

- `description` (String) Ruleset description
- `include_by_default` (Boolean) Indicates that the ruleset should be automatically included in new deployments (Defaults to false)
- `rule` (Block Set) Set of rules, which the ruleset is made of. (see [below for nested schema](#nestedblock--rule))

### Read-Only

- `id` (String) Unique identifier of this resource.

<a id="nestedblock--rule"></a>
### Nested Schema for `rule`

Optional:

- `azure_endpoint_guid` (String) Azure endpoint GUID. Only applicable when the ruleset type is set to `azure_private_endpoint`
- `azure_endpoint_name` (String) Azure endpoint name. Only applicable when the ruleset type is set to `azure_private_endpoint`
- `description` (String) Description of this individual rule
- `source` (String) Traffic filter source: IP address, CIDR mask, or VPC endpoint ID, **only required** when the type is not `azure_private_endpoint`

Read-Only:

- `id` (String) Computed rule ID

## Import

Traffic filters can be imported using the `id`, for example:

```shell
terraform import ec_deployment_traffic_filter.name 320b7b540dfc967a7a649c18e2fce4ed
```
